/*! 
 * Script: jQuery.dataDisplay.js 
 * Description: jquery.dataDisplay aids the developer in writing concise conditions against elements within a form based setting, in order to control the display of elements based on the state of a form.  
 * Copyright: Copyright (c) 2014-2017 Graham Dixon - http://gdixon.co.uk/  
 * Author: GDixon  
 * Email: gdixon@assetinfo.co.uk  
 * Licensed: MIT 
 * Requires: jQuery > 1.9 
 * Version: 0.0.1 
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){var e={eventName:".dataDisplay",dataAttr:"dataDisplay",condsAttr:"data-display",resetsAttr:"data-display-resets",initFire:!0,keyEventsFire:!0},n={"!empty":{rgx:"\\!empty\\({([^}]+)}\\)",exec:function(e,n){var i="(";return t('[name*="'+e+'"]',n).each(function(){var e=t(this).val();i="("==i?i+'"'+e+'" !== "" ':i+' && "'+e+'" !== "" '}),i+=")"}},empty:{rgx:"empty\\({([^}]+)}\\)",exec:function(e,n){var i="(";return t('[name*="'+e+'"]',n).each(function(){var e=t(this).val();i="("==i?i+'"'+e+'" == "" ':i+' && "'+e+'" == "" '}),i+=")"}},length:{rgx:"length\\({([^}]+)}\\)",exec:function(e,n){var i='[name*="'+e+'"]';if(void 0!==t(i+":checked",n).val())s=t(i+":checked",n).val().length;else var s=t(i,n).val().length;return s}},"is greater than or equal to":{rgx:"is\\sgreater\\sthan\\s(?:or\\s)?equal\\sto",exec:function(t,e){return">="}},"is less than or equal to":{rgx:"is\\sless\\sthan\\s(?:or\\s)?equal\\sto",exec:function(t,e){return"<="}},"is greater than":{rgx:"is\\sgreater\\sthan",exec:function(t,e){return">"}},"is less than":{rgx:"is\\sless'sthan",exec:function(t,e){return"<"}},"is equal to":{rgx:"is\\sequal\\sto",exec:function(t,e){return"=="}}};t.fn.dataDisplay=function(i){var r="string"==typeof i?[i]:i;if(t(this).length){var a=t.extend({},e,void 0!==r?r:[]),o=t.extend({},n,void 0!==a.funcs?a.funcs:[]);if(void 0===t(this).data(a.dataAttr))c=t(this).data(a.dataAttr,new s(this,a,o));else if(void 0!==i&&"destroy"==i)c=this.data(a.dataAttr).destroy();else if(void 0!==i)c=this.data(a.dataAttr).destroy().init(this,a,o);else var c=this.data(a.dataAttr);t(this).data(a.dataAttr,c)}return c};var s=function(e,n,s){var r=this;return r.init=function(e,n,s){var r=this;return r.el=e,r.settings=n,r.funcs=s,t(r.el).each(function(){var e=t(this);t("["+r.settings.condsAttr+"]",e).each(function(){var n=t(this),s=n.attr(r.settings.condsAttr);if(isNaN(s)){void 0===r.conditions&&(r.conditions=[]);var a=r.debounce(function(t,e,n,i){return r.applyResets(t,e,n,i)}),o=r.debounce(function(t,e,n,i){return r.applyConditions(t,e,n,i)}),c=void 0!==n.attr("style")?n.attr("style"):"",d=void 0!==n.attr(r.settings.resetsAttr)?n.attr(r.settings.resetsAttr):"",l=r.findFields(d),u=r.findFields(s),f=r.conditions.length,h="change"+r.settings.eventName+(r.settings.keyEventsFire?" keyup"+r.settings.eventName:"");for(i=0;i<u.length;i++){var g=u[i],v=r.getFieldSelector(g);if(0==t(v,e).length)return;t(v,e).on(h,{el:n,context:e,resets:d,resetFields:l,conditions:s,conditionFields:u},function(t){a(t.data.resets,t.data.resetFields,t.data.el,t.data.context),o(t.data.conditions,t.data.conditionFields,t.data.el,t.data.context)})}n.attr(r.settings.resetsAttr,f).attr(r.settings.condsAttr,f),r.applyResets(d,l,n,e),r.settings.initFire&&o(s,u,n,e),r.conditions[f]={this:n,styles:c,resets:d,resetFields:l,conditions:s,conditionFields:l}}})}),r},r.debounce=function(t,e,n){var i;return function(){var s=this,r=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(s,r)},e),a&&t.apply(s,r)}},r.findFields=function(t){for(var e=[],n=/{([^}]+)}/gi;null!=(m=n.exec(t));)e[e.length]=m[1];return e},r.getFieldSelector=function(t){return'[name*="'+t+'"]'},r.escapeRegExp=function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},r.applyResets=function(e,n,i,s){t(i,s).hide(),e=this.replaceFieldValHolders(e,n),new Function("$this",e||"")(i)},r.applyConditions=function(t,e,n,i){var s=this;for(func in s.funcs)for(var r=s.funcs[func],a=new RegExp(r.rgx,"gi");null!=(m=a.exec(t));){var o=r.exec(m[1],i);t=t.replace(new RegExp(r.rgx),o)}for(var c=(t=(t=s.replaceFieldValHolders(t,e)).replace(/\s\s+/g," ")).split("; ||"),d=0;d<c.length;d++){var l=c[d].split("::");1==l.length?s.showOnCondition(c[d],n):s.funcOnCondition(l,n)}},r.replaceFieldValHolders=function(e,n){var s=this;for(n="string"==typeof n?[n]:n,i=0;i<n.length;i++){var r=n[i],a=s.getFieldSelector(r),o="",c="";void 0!==(o=void 0!==t(a+":checked").val()?t(a+":checked").val():t(a).val())&&(c=1==isNaN(o)?'"'+encodeURIComponent(o)+'"':parseFloat(o),e=e.replace(new RegExp("{"+s.escapeRegExp(r)+"}","g"),c))}return e},r.showOnCondition=function(e,n){var i="return ("+(e=e.replace(/;(\s+)?$/,""))+");";1==new Function(i)()&&t(n).show()},r.funcOnCondition=function(e,n){for(var i=0;i<e.length;i++){var s="return ("+e[0]+");";if(i>0)for(var r=e[i].split(";"),a=0;a<r.length;a++)if(1==new Function(s)()){t(n).show();var o=" return ("+(r[a].length?r[a]:"true")+");";new Function("$this",o)(n)}}},r.destroy=function(e){var n=this;return t(n.el).each(function(){var e=t(this);t("["+n.settings.condsAttr+"]",e).each(function(){var s=t(this),r=s.attr(n.settings.condsAttr),a=n.conditions[r].styles,o=n.conditions[r].resets,c=n.conditions[r].conditions,d=n.findFields(c);if(0!=d.length){for(i=0;i<d.length;i++){var l=d[i],u=n.getFieldSelector(l);t(u,e).off(n.settings.eventName)}s.attr("style",a).attr(n.settings.condsAttr,c).attr(n.settings.resetsAttr,o)}}),t(n.el).removeData("dataDisplay")}),this},r.init(e,n,s)}});