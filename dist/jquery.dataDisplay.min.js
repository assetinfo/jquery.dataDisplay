/*! 
 * Script: jQuery.dataDisplay.js 
 * Description: jquery.dataDisplay aids the developer in writing concise conditions against elements within a form based setting, in order to control the display of elements based on the state of a form.  
 * Copyright: Copyright (c) 2014-2017 Graham Dixon - http://gdixon.co.uk/  
 * Author: GDixon  
 * Email: gdixon@assetinfo.co.uk  
 * Licensed: MIT 
 * Requires: jQuery > 1.9 
 * Version: 0.0.1 
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){var e={eventName:".dataDisplay",dataAttr:"dataDisplay",condsAttr:"data-display",resetsAttr:"data-display-resets",initFire:!0,keyEventsFire:!0},n={"!empty":{rgx:"\\!empty\\({([^}]+)}\\)",exec:function(e,n){var i="(";return t('[name*="'+e+'"]',n).each(function(){var e=t(this).val();i="("==i?i+'"'+e+'" !== "" ':i+' && "'+e+'" !== "" '}),i+=")"}},empty:{rgx:"empty\\({([^}]+)}\\)",exec:function(e,n){var i="(";return t('[name*="'+e+'"]',n).each(function(){var e=t(this).val();i="("==i?i+'"'+e+'" == "" ':i+' && "'+e+'" == "" '}),i+=")"}},length:{rgx:"length\\({([^}]+)}\\)",exec:function(e,n){var i='[name*="'+e+'"]';if(void 0!==t(i+":checked",n).val())r=t(i+":checked",n).val().length;else var r=t(i,n).val().length;return r}},"is greater than or equal to":{rgx:"is\\sgreater\\sthan\\s(?:or\\s)?equal\\sto",exec:function(t,e){return">="}},"is less than or equal to":{rgx:"is\\sless\\sthan\\s(?:or\\s)?equal\\sto",exec:function(t,e){return"<="}},"is greater than":{rgx:"is\\sgreater\\sthan",exec:function(t,e){return">"}},"is less than":{rgx:"is\\sless'sthan",exec:function(t,e){return"<"}},"is equal to":{rgx:"is\\sequal\\sto",exec:function(t,e){return"=="}}};t.fn.dataDisplay=function(i){var s="string"==typeof i?[i]:i;if(t(this).length){var a=t.extend({},e,void 0!==s?s:[]),o=t.extend({},n,void 0!==a.funcs?a.funcs:[]);if(void 0===t(this).data(a.dataAttr))c=t(this).data(a.dataAttr,new r(this,a,o));else if(void 0!==i&&"destroy"==i)c=this.data(a.dataAttr).destroy();else if(void 0!==i)c=this.data(a.dataAttr).destroy().init(this,a,o);else var c=this.data(a.dataAttr);t(this).data(a.dataAttr,c)}return c};var r=function(e,n,r){var s=this;return s.init=function(e,n,r){var s=this;return s.el=e,s.settings=n,s.funcs=r,t(s.el).each(function(){var e=t(this);t("["+s.settings.condsAttr+"]",e).each(function(){var n=t(this),r=n.attr(s.settings.condsAttr);if(isNaN(r)){void 0===s.conditions&&(s.conditions=[]);var a=s.debounce(function(t){return s.applyDefaults(t)}),o=s.debounce(function(t,e,n,i){return s.applyConditions(t,e,n,i)}),c=void 0!==n.attr("style")?n.attr("style"):"",l=void 0!==n.attr(s.settings.resetsAttr)?n.attr(s.settings.resetsAttr):"",d=s.conditions.length;s.conditions[d]={this:n,resets:l,styles:c,conditions:r},n.attr(s.settings.condsAttr,d);n.attr("name");var u=s.findFields(r),f="change"+s.settings.eventName+(s.settings.keyEventsFire?" keyup"+s.settings.eventName:"");for(i=0;i<u.length;i++){if(0==t(s.getFieldSelector(u[i]),e).length)return;var h=u[i],g=s.getFieldSelector(h);t(g,e).on(f,{el:n,context:e,conditions:r,conditionFields:u},function(t){a(t.data.el),o(t.data.conditions,t.data.conditionFields,t.data.el,t.data.context)})}s.applyDefaults(n),s.settings.initFire&&o(r,u,n,e)}})}),s},s.debounce=function(t,e,n){var i;return function(){var r=this,s=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(r,s)},e),a&&t.apply(r,s)}},s.findFields=function(t){for(var e=[],n=/{([^}]+)}/gi;null!=(m=n.exec(t));)e[e.length]=m[1];return e},s.getFieldSelector=function(t){return'[name*="'+t+'"]'},s.escapeRegExp=function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},s.searchArray=function(t,e){for(var n in t)if(t[n]==e)return n;return-1},s.applyDefaults=function(e){if(t(e).hide(),isNaN(t(e).attr(this.settings.resetsAttr))){n=t(e).attr(this.settings.resetsAttr);t(e).attr(this.settings.resetsAttr,t(e).attr(this.settings.condsAttr))}else var n=this.conditions[t(e).attr(this.settings.condsAttr)].resets;new Function("$this",n||"")(e)},s.applyConditions=function(t,e,n,i){var r=this;field="",fieldSelector="",fieldValue="",parseVal="",c=[],d=[];for(func in r.funcs)for(var s=r.funcs[func],a=new RegExp(s.rgx,"gi");null!=(m=a.exec(t));){var o=s.exec(m[1],i);t=t.replace(new RegExp(s.rgx),o)}if("string"==typeof e)fieldSelector=r.getFieldSelector(e),t=r.replaceFieldInCondition(fieldSelector,e,t);else for(l=0;l<e.length;l++)field=e[l],fieldSelector=r.getFieldSelector(field),t=r.replaceFieldInCondition(fieldSelector,field,t);for(var c=(t=t.replace(/\s\s+/g," ")).split("; ||"),l=0;l<c.length;l++){var d=c[l].split("::");1==d.length?r.showOnCondition(c[l],n):r.funcOnCondition(d,n)}},s.replaceFieldInCondition=function(e,n,i){var r=this,s="",a="";return void 0!==(s=void 0!==t(e+":checked").val()?t(e+":checked").val():t(e).val())&&(a=1==isNaN(s)?'"'+encodeURIComponent(s)+'"':parseFloat(s),i=i.replace(new RegExp("{"+r.escapeRegExp(n)+"}","g"),a)),i},s.showOnCondition=function(e,n){var i="return ("+(e=e.replace(/;(\s+)?$/,""))+");";1==new Function(i)()&&t(n).show()},s.funcOnCondition=function(e,n){for(var i=0;i<e.length;i++){var r="return ("+e[0]+");";if(i>0)for(var s=e[i].split(";"),a=0;a<s.length;a++)if(1==new Function(r)()){t(n).show();var o=" return ("+(s[a].length?s[a]:"true")+");";new Function("$this",o)(n)}}},s.destroy=function(e){var n=this;return t(n.el).each(function(){var e=t(this);t("["+n.settings.condsAttr+"]",e).each(function(){var r=t(this),s=r.attr(n.settings.condsAttr),a=n.conditions[s].styles,o=n.conditions[s].resets,c=n.conditions[s].conditions,l=n.findFields(c);if(0!=l.length){for(i=0;i<l.length;i++){var d=l[i],u=n.getFieldSelector(d);t(u,e).off(n.settings.eventName)}r.attr("style",a).attr(n.settings.condsAttr,c).attr(n.settings.resetsAttr,o)}}),t(n.el).removeData("dataDisplay")}),this},s.init(e,n,r)}});